plugins {
    id 'java'
    id 'application'
    id 'jacoco'
    id 'com.github.johnrengelman.shadow' version '5.2.0'
}

repositories {
    mavenCentral()
    maven {
        url 'https://repo.gradle.org/gradle/libs-releases'
    }
}

sourceSets {
    libsDirName = 'lib'
    generated {
        java.srcDir "${buildDir}/generated/sources/annotationProcessor/java/main"
    }
}

dependencies {
    compile 'org.gradle:gradle-tooling-api:6.1.1'
    compile 'com.eclipsesource.minimal-json:minimal-json:0.9.5'
    compile "org.java-websocket:Java-WebSocket:1.4.0"
    compile "com.google.dagger:dagger:2.26"
    annotationProcessor "com.google.dagger:dagger-compiler:2.26"
    runtimeOnly 'org.slf4j:slf4j-simple:1.7.30'
    testImplementation 'junit:junit:4.13'
}

application {
    mainClassName = 'com.github.badsyntax.gradletasks.Application'
}

shadowJar {
    minimize()
}

task createStartScripts(type: CreateStartScripts) {
    dependsOn shadowJar
    outputDir = file('build/customScripts')
    mainClassName = application.mainClassName
    applicationName = project.name
    classpath = files(shadowJar.outputs.files)
}

task generateLib(type: Copy) {
    dependsOn build, createStartScripts

    from file("$buildDir/lib/${project.name}-all.jar")
    into file("$buildDir/../../lib/${project.name}-all.jar")

    from "$buildDir/customScripts/${project.name}", "$buildDir/customScripts/${project.name}.bat"
    into "$buildDir/../../lib"
}
